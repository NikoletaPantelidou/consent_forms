<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Consent & LEAP-Q â€” Form</title>
<style>
  :root { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; font-size: 16px; color: #111; }
  body { margin: 20px; background:#fff; }
  h1, h2 { margin: .3em 0; }
  form { max-width: 900px; margin: 0 auto; }
  .grid { display: grid; gap: 8px; grid-template-columns: 1fr 1fr; }
  .full { grid-column: 1 / -1; }
  label { display:block; font-weight:600; margin-bottom:4px; }
  input, textarea, select {
    width:100%; padding:8px; border:1px solid #ccc; border-radius:6px; box-sizing:border-box;
  }
  fieldset { margin: 16px 0; padding:12px; border-radius:8px; border:1px solid #ddd; }
  legend { font-weight:700; padding:0 6px; }
  button { padding:10px 14px; border-radius:8px; border:0; background:#0069ff; color:white; cursor:pointer; font-weight:600; }
  .secondary { background:#eee; color:#111; }
  .error { color:#c00; font-weight:700; }
  .output { white-space:pre-wrap; background:#f7f7f7; padding:10px; border-radius:6px; border:1px solid #eee; margin-top:12px; }
  @media (max-width:700px) {
    .grid { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>
<form id="consentForm" autocomplete="off">
  <h1>Consent & Language Experience Questionnaire (LEAP-Q)</h1>
  <p>Please fill in the following information.</p>

  <!-- Basic info -->
  <div class="grid">
    <div><label>Last Name</label><input name="last_name"></div>
    <div><label>First Name</label><input name="first_name"></div>
    <div><label>Date</label><input type="date" name="today_date"></div>
    <div><label>Age</label><input type="number" name="age" min="0"></div>
    <div><label>Date of Birth</label><input type="date" name="dob"></div>
    <div>
      <label>Sex</label>
      <select name="sex">
        <option value="">--</option>
        <option>Female</option>
        <option>Male</option>
        <option>Other</option>
      </select>
    </div>
  </div>

  <!-- Dominance & acquisition -->
  <fieldset><legend>(1) Languages in order of dominance</legend>
    <div class="grid">${[1,2,3,4,5].map(i=>`<div><label>${i}</label><input name="dominance_${i}"></div>`).join('')}</div>
  </fieldset>
  <fieldset><legend>(2) Languages in order of acquisition (native first)</legend>
    <div class="grid">${[1,2,3,4,5].map(i=>`<div><label>${i}</label><input name="acq_${i}"></div>`).join('')}</div>
  </fieldset>

  <!-- Helper to generate dropdown options -->
  <script>
    const pctOptions = Array.from({length:10},(_,i)=>`<option value="${(i+1)*10}">${(i+1)*10}%</option>`).join('');
  </script>

  <!-- Exposure / Reading / Speaking -->
  <fieldset><legend>(3) Percent exposure to each language (sum=100)</legend>
    <div class="grid" id="expSec"></div>
  </fieldset>
  <fieldset><legend>(4) Reading language use (sum=100)</legend>
    <div class="grid" id="readSec"></div>
  </fieldset>
  <fieldset><legend>(5) Speaking language use (sum=100)</legend>
    <div class="grid" id="speakSec"></div>
  </fieldset>

  <!-- Cultures etc. -->
  <fieldset>
    <legend>(6) Cultures and identification (0-10)</legend>
    <div class="grid">${[1,2,3].map(i=>`
      <div><label>Culture ${i}</label><input name="culture_${i}"></div>
      <div><label>Identification (0-10)</label><select name="culture_val_${i}">
        <option value="">--</option>${Array.from({length:11},(_,j)=>`<option value="${j}">${j}</option>`).join('')}
      </select></div>`).join('')}</div>
    <div class="full"><label>Other notes</label><textarea name="culture_notes"></textarea></div>
  </fieldset>

  <!-- Education -->
  <fieldset><legend>(7) Education</legend>
    <div class="grid">
      <div><label>Years of education</label><input type="number" name="education_years"></div>
      <div><label>Highest level</label>
        <select name="education_level">
          <option value="">--</option>
          <option>High School</option><option>College</option>
          <option>Masters</option><option>PhD/MD/JD</option>
          <option>Other</option>
        </select>
      </div>
    </div>
  </fieldset>

  <!-- Immigration -->
  <fieldset><legend>(8) Immigration</legend>
    <div class="grid">
      <div><label>Date of immigration to USA</label><input type="date" name="immig_date_us"></div>
      <div><label>Other country/date</label><input name="immig_other"></div>
    </div>
  </fieldset>

  <!-- Issues -->
  <fieldset><legend>(9) Vision/hearing/language/learning issues</legend>
    <div>
      <label><input type="checkbox" name="issue_vision" value="vision"> Vision problem</label>
      <label><input type="checkbox" name="issue_hearing" value="hearing"> Hearing impairment</label>
      <label><input type="checkbox" name="issue_language" value="language"> Language disability</label>
      <label><input type="checkbox" name="issue_learning" value="learning"> Learning disability</label>
    </div>
    <label>If yes, explain:</label>
    <textarea name="issues_explain" rows="3"></textarea>
  </fieldset>

  <!-- 5 Language-specific sections -->
  <div id="langBlocks"></div>

  <!-- Actions -->
  <div style="display:flex;gap:12px;margin-top:12px;">
    <button type="submit" id="submitBtn">Submit</button>
    <button type="button" id="clearBtn" class="secondary">Clear</button>
  </div>
  <div id="error" class="error"></div>
  <pre id="output" class="output" style="display:none;"></pre>
</form>

<script>
/* ---------- dynamic sections ---------- */
function makePercentSection(id,prefix){
  const div=document.getElementById(id);
  for(let i=1;i<=5;i++){
    div.insertAdjacentHTML("beforeend",
      `<div><label>Language ${i}</label><input name="${prefix}_lang_${i}"></div>
       <div><label>%</label><select name="${prefix}_pct_${i}"><option value="">--</option>${pctOptions}</select></div>`
    );
  }
}
makePercentSection("expSec","exp");
makePercentSection("readSec","read");
makePercentSection("speakSec","speak");

/* ---------- 5 Language-specific blocks ---------- */
const langContainer=document.getElementById("langBlocks");
for(let i=1;i<=5;i++){
  langContainer.insertAdjacentHTML("beforeend",`
  <fieldset>
  <legend>Language-specific section ${i}</legend>
  <div class="grid">
    <div><label>Language</label><input name="lang_block_${i}"></div>
    <div><label>Age began acquiring</label><input type="number" name="age_began_${i}"></div>
    <div><label>Age became fluent</label><input type="number" name="age_fluent_${i}"></div>
  </div>
  <div class="grid">
    <div><label>Speaking (0-10)</label><select name="speaking_${i}">${Array.from({length:11},(_,j)=>`<option>${j}</option>`).join('')}</select></div>
    <div><label>Understanding (0-10)</label><select name="understanding_${i}">${Array.from({length:11},(_,j)=>`<option>${j}</option>`).join('')}</select></div>
    <div><label>Reading (0-10)</label><select name="reading_${i}">${Array.from({length:11},(_,j)=>`<option>${j}</option>`).join('')}</select></div>
  </div>
  </fieldset>`);
}

/* ---------- helpers ---------- */
function formToObject(f){
  const o={},fd=new FormData(f);
  for(const [k,v] of fd.entries()){
    if(o[k]){ if(!Array.isArray(o[k]))o[k]=[o[k]]; o[k].push(v);} else o[k]=v;
  }
  return o;
}

/* ---------- behavior ---------- */
const f=document.getElementById("consentForm"), err=document.getElementById("error"),
out=document.getElementById("output");
document.getElementById("clearBtn").onclick=()=>confirm("Clear all fields?")&&f.reset();

f.onsubmit=e=>{
  e.preventDefault(); err.textContent=""; out.style.display="none";
  const data=formToObject(f); data._timestamp=new Date().toISOString();

  // send to parent (PCIbex)
  if(window.parent&&window.parent!==window)
    window.parent.postMessage({type:'pcibex_consent_leapq',payload:data},'*');

  out.style.display="block";
  out.textContent=JSON.stringify(data,null,2);
};
</script>
</body>
</html>

